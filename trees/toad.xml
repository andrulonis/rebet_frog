<root BTCPP_format="4" main_tree_to_execute="TOAD">
  	<BehaviorTree ID="TOAD">
		<Sequence>
			<Script code="task_weight:=1.0; obj_power_weight:=1.0; @obj_power_metric:=-10.0; move_pow_weight:=1.0; @move_pow_metric:=-10.0; move_eff_weight:=1.0; @move_eff_metric:=-10.0; safe_weight:=1.0; @safe_metric:=-10.0"/>
		
			<Sleep msec="3000"/> 
			<RetryUntilSuccessful num_attempts="-1">
				<getRobotPose topic_name="/odom" out_pose="{current_pose}" />
			</RetryUntilSuccessful>

			<initialPose topic_name="initialpose" in_pose="{current_pose}" />
			<Sleep msec="3000"/>
			
			<RetryUntilSuccessful num_attempts="-1">
				<getMap service_name="/map_server/map" map_retrieved="{current_map}"/>
			</RetryUntilSuccessful>
			
			<filterObstacles map_to_filter="{current_map}" obstacle_positions="{route_poses}" obstacle_number="{num_obstacles}"/>
			<Sleep msec="1000"/>
			<Repeat num_cycles="{num_obstacles}">
				<Sequence>
					<ForceSuccess>
						<visitObs poses="{route_poses}" name_of_task="{@current_task}"  in_pose="{current_pose}" action_name="navigate_to_pose"/>
					</ForceSuccess>
					<DetectAccuracyQR metric="{@detect_accuracy_metric}" objs_detected="{@objs_detected}">
					<DetectPowerQR metric="{@detect_power_metric}" objs_detected="{@objs_detected}">
					<!-- <AdjustDetectModel adaptation_strategy="mdp_strategy" model_dir="/home/andrulonis/rebet_ws/src/rebet_frog/PRISM_models/mdp" adaptation_options="yolov8n;yolov8x" adaptation_subject="detect_model_name" subject_location="detect_object" detect_power_metric="{@detect_power_metric}" objs_detected="{@objs_detected}"> -->
					<AdjustDetectModel adaptation_strategy="markov_chain_strategy" model_dir="/home/andrulonis/rebet_ws/src/rebet_frog/PRISM_models/markov_chain" adaptation_options="yolov8n;yolov8x" adaptation_subject="detect_model_name" subject_location="detect_object" detect_power_metric="{@detect_power_metric}" objs_detected="{@objs_detected}">
						<DetectObject service_name="/detect_object_srv" objs_detected="{@objs_detected}" detect_power_metric="{@detect_power_metric}"/>
					</AdjustDetectModel>
					</DetectPowerQR>
					</DetectAccuracyQR>
				</Sequence>
			</Repeat>
		</Sequence>
    </BehaviorTree>
</root>
